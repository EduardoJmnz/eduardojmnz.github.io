<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Etiquetas Pallet (20x10) - 2 por hoja</title>

  <style>
    :root{
      --bg:#0b0f17;
      --text:#e5e7eb;
      --muted:#9ca3af;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 30% 0%, #13203a 0%, var(--bg) 55%);
      color:var(--text);
    }

    header{
      padding:18px 16px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.2);
      backdrop-filter: blur(8px);
      position: sticky;
      top:0;
      z-index: 2;
    }
    header .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      max-width:1200px;
      margin:0 auto;
    }
    h1{ font-size:16px; margin:0; font-weight:650; letter-spacing:.2px; }
    .sub{ font-size:12px; color:var(--muted); margin-top:4px; }

    main{
      max-width:1200px;
      margin: 18px auto 40px;
      padding: 0 16px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 16px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 10px 35px rgba(0,0,0,.25);
    }
    .card .hd{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
    }
    .card .bd{ padding: 14px; }

    label{
      display:block;
      font-size:12px;
      color: var(--muted);
      margin: 10px 0 6px;
    }
    input{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }

    .btns{
      display:flex;
      gap:10px;
      margin-top: 14px;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
    }
    button.primary{ background: #2563eb; border-color:#2563eb; }
    button:disabled{ opacity:.55; cursor:not-allowed; }

    .hint{
      margin-top:10px;
      font-size:12px;
      color: var(--muted);
      line-height:1.35;
    }

    /* ====== PREVIEW ======
       Carta approx @96dpi: 816 x 1056 px
       Etiqueta 20x10 cm -> (20/2.54)*96 = 756px; (10/2.54)*96 = 378px
       Para que entren 2 rotadas, rotamos 90° dentro del slot.
    */
    .previewWrap{ padding: 14px; }
    .pages{
      display:flex;
      flex-direction:column;
      gap: 18px;
      align-items:flex-start;
    }
    .sheet{
      width: 816px;
      height: 1056px;
      background: rgba(255,255,255,.04);
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 16px;
      position:relative;
      overflow:hidden;
    }

    .slot{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 420px;   /* slot vertical para etiqueta rotada */
      height: 780px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .slot.top{ top: 22px; }
    .slot.bottom{ bottom: 22px; }

    .labelRot{
      width: 756px;   /* 20cm @96dpi */
      height: 378px;  /* 10cm @96dpi */
      transform: rotate(90deg);
      transform-origin:center;
      background:#fff;
      color:#000;
      border: 2px solid #000;
    }

    /* ====== DISEÑO DE LA ETIQUETA (preview) ====== */
    .labelInner{
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: 1fr 170px;
    }
    .L{
      border-right: 2px solid #000;
      display:grid;
      grid-template-rows: 52% 48%;
    }
    .Ltop{
      padding: 10px 12px 8px;
      border-bottom: 2px solid #000;
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .estiloLbl{ font-weight:800; font-size:20px; line-height:1; }
    .estiloVal{ font-weight:700; font-size:18px; line-height:1.1; word-break: break-word; }
    .cliente{
      margin-top:4px;
      font-weight:700;
      text-align:center;
      font-size: 14px;
      line-height:1.15;
      padding: 0 6px;
    }

    .tbl{
      width:100%;
      height:100%;
      display:grid;
      grid-template-rows: 34px 1fr;
    }
    .tblHead{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      border-bottom: 2px solid #000;
      font-weight:900;
      font-size:14px;
    }
    .tblHead > div{
      display:flex;
      align-items:center;
      justify-content:center;
      border-right: 2px solid #000;
    }
    .tblHead > div:last-child{ border-right: none; }
    .tblRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      font-weight:800;
      font-size:18px;
    }
    .tblRow > div{
      display:flex;
      align-items:center;
      justify-content:center;
      border-right: 2px solid #000;
    }
    .tblRow > div:last-child{ border-right: none; }

    .R{
      display:grid;
      grid-template-rows: 42% 58%;
    }
    .rtop{
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .kv{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size: 20px;
      font-weight:900;
      line-height:1;
    }
    .kv span:last-child{ font-size: 26px; font-weight: 950; }
    .rbottom{
      border-top: 2px solid #000;
      padding: 10px 10px 6px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .barcodeBox{
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 56px;
    }
    .barcodeTxt{
      text-align:center;
      font-size: 14px;
      font-weight: 800;
      letter-spacing:.6px;
    }

    /* Export area oculto */
    #exportArea{
      position: fixed;
      left: -99999px;
      top: 0;
      width: 0;
      height: 0;
      overflow: hidden;
      pointer-events:none;
    }

    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      .sheet{
        transform: scale(.85);
        transform-origin: top left;
      }
    }
  </style>
</head>

<body>
<header>
  <div class="row">
    <div>
      <h1>Generador de etiquetas 20×10 cm (2 por hoja carta, rotadas)</h1>
      <div class="sub">Calcula cajas automáticamente (incluye última caja parcial) y exporta a PDF.</div>
    </div>
    <div class="sub" id="status"></div>
  </div>
</header>

<main>
  <section class="card">
    <div class="hd"><strong>Datos</strong></div>
    <div class="bd">
      <label>Estilo</label>
      <input id="estilo" placeholder="Ej: NBCE1302/30M0H00003098" />

      <div class="grid3">
        <div>
          <label>Cantidad (opcional)</label>
          <input id="cantidad" type="number" min="0" step="1" placeholder="Ej: 9" />
        </div>
        <div>
          <label>Piezas por caja</label>
          <input id="ppc" type="number" min="1" step="1" value="4" />
        </div>
        <div>
          <label>Total de piezas</label>
          <input id="totalPiezas" type="number" min="0" step="1" value="50" />
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Número de cajas (opcional)</label>
          <input id="numCajas" type="number" min="0" step="1" placeholder="(si lo dejas vacío, se calcula)" />
        </div>
        <div>
          <label>SKU / Código para barcode (opcional)</label>
          <input id="sku" placeholder="Si vacío, usa lo de después de la / en Estilo" />
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Color</label>
          <input id="color" placeholder="Ej: 30" />
        </div>
        <div>
          <label>Talla</label>
          <input id="talla" placeholder="Ej: 98" />
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="btnGenerate">Generar</button>
        <button id="btnPDF" disabled>Descargar PDF (Carta, 2 por hoja)</button>
      </div>

      <div class="hint">
        - Cliente/Dirección es fijo (no editable).<br/>
        - Si <b># cajas</b> está vacío, se calcula con <b>Total piezas</b> y <b>Piezas por caja</b>.<br/>
        - La última etiqueta puede salir con cantidad menor si hay remanente.
      </div>
    </div>
  </section>

  <section class="card">
    <div class="hd"><strong>Vista previa</strong></div>
    <div class="previewWrap">
      <div class="pages" id="pages"></div>
    </div>
  </section>
</main>

<div id="exportArea"></div>

<!-- Librerías -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

<script type="module" src="./app.js"></script>
</body>
</html>
