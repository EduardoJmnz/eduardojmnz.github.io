<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mapa estelar</title>
  <style>
    :root { color-scheme: dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b1020; color:#e8ecff; }
    .wrap { display: grid; grid-template-columns: 340px 1fr; min-height: 100vh; }
    .panel { padding: 16px; border-right: 1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.02); }
    .panel h1 { margin: 0 0 12px; font-size: 18px; }
    .row { margin: 10px 0; display: grid; gap: 6px; }
    label { font-size: 12px; opacity: .9; }
    input, select, button { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: inherit; }
    button { cursor: pointer; font-weight: 600; }
    button:hover { background: rgba(255,255,255,.07); }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .stage { display:flex; align-items:center; justify-content:center; padding: 16px; }
    .hint { font-size: 12px; opacity: .75; line-height: 1.35; margin-top: 10px; }
    .small { font-size: 12px; opacity: .85; }
    a { color: #bcd1ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="panel">
      <h1>Mapa estelar</h1>

      <div class="row">
        <label>Título</label>
        <input id="title" value="Nuestra noche" />
      </div>

      <div class="row">
        <label>Latitud (°)</label>
        <input id="lat" type="number" step="0.0001" value="19.4326" />
      </div>

      <div class="row">
        <label>Longitud (°) (Oeste negativo)</label>
        <input id="lon" type="number" step="0.0001" value="-99.1332" />
      </div>

      <div class="row">
        <label>Fecha y hora (local)</label>
        <input id="dt" type="datetime-local" />
        <div class="small">Tip: si no sabes, usa una hora nocturna (20:00–23:00).</div>
      </div>

      <div class="row">
        <label>Estilo</label>
        <select id="style">
          <option value="classic" selected>Classic (blanco sobre oscuro)</option>
          <option value="inverted">Invertido (oscuro sobre claro)</option>
        </select>
      </div>

      <div class="row">
        <label>Mostrar</label>
        <select id="overlay">
          <option value="stars" selected>Estrellas</option>
          <option value="stars+const">Estrellas + constelaciones</option>
          <option value="const">Solo constelaciones</option>
        </select>
      </div>

      <div class="row">
        <label>Tamaño (px) (export PNG)</label>
        <input id="size" type="number" step="100" value="2000" />
      </div>

      <div class="btns">
        <button id="render">Generar</button>
        <button id="exportSvg">Exportar SVG</button>
        <button id="exportPng">Exportar PNG</button>
        <button id="printPdf" style="grid-column:1/3;">Imprimir / Guardar como PDF</button>
      </div>

      <div class="hint">
        <b>PDF:</b> usa “Imprimir / Guardar como PDF” y elige “Guardar como PDF” en tu navegador.
        <br><br>
        Si quieres <b>300 DPI</b> para póster: exporta PNG a 6000–9000px (dependiendo del tamaño físico).
      </div>
    </aside>

    <main class="stage">
      <div id="mount"></div>
    </main>
  </div>

  <script type="module">
    import { renderStarMap, exportSVG, exportPNG, setTheme } from "./skymap.js";

    const $ = (id) => document.getElementById(id);

    // Default: ahora (local)
    const now = new Date();
    const pad = (n) => String(n).padStart(2, "0");
    const local = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
    $("dt").value = local;

    function getConfig() {
      const title = $("title").value.trim() || "Mapa estelar";
      const lat = Number($("lat").value);
      const lon = Number($("lon").value);
      const dtLocal = $("dt").value; // "YYYY-MM-DDTHH:mm"
      const style = $("style").value;
      const overlay = $("overlay").value;
      const size = Math.max(600, Number($("size").value) || 2000);

      // Interpretar datetime-local como local del navegador
      const date = new Date(dtLocal);
      if (Number.isNaN(date.getTime())) throw new Error("Fecha inválida");

      return { title, lat, lon, date, style, overlay, size };
    }

    function doRender() {
      const cfg = getConfig();
      setTheme(cfg.style);
      renderStarMap(document.getElementById("mount"), cfg);
    }

    $("render").addEventListener("click", () => doRender());
    $("exportSvg").addEventListener("click", () => exportSVG("mapa-estelar.svg"));
    $("exportPng").addEventListener("click", () => {
      const cfg = getConfig();
      exportPNG("mapa-estelar.png", cfg.size);
    });
    $("printPdf").addEventListener("click", () => window.print());

    doRender();
  </script>
</body>
</html>
